generate-schemas:
  in: ./generators/database.schema.jsonnet
  out: ./schemas/database.autogen.schema.json
  run: jsonnet $in | jq -S | tee $out

generate-table-ddl:
  in:
    schema: ./schemas/database.autogen.schema.json
    codegen: ./generators/create-database.py
  out: ./sql/create-database.autogen.sql
  run: python ${in.codegen} ${in.schema} | tee $out

generate-yesql-query-template:
  in:
    schema: ./schemas/database.autogen.schema.json
    codegen: ./generators/create-operations-yesql.py
  out: ./sql/database-operations.autogen.yesql.sql
  run: python ${in.codegen} ${in.schema} | tee $out

generate-python-target:
  in:
    generator: generators/render-sqlite-queries.py
    database_ops: sql/database-operations.autogen.yesql.sql
    database_init: ./sql/create-database.autogen.sql
  out:
    operations: ./targets/python/squeakyv/_operations.py
    sql_copy: ./targets/python/squeakyv/_schema.sql
  run: |
    cp ${in.database_init} ${out.sql_copy}
    python ${in.generator} python ${in.database_ops} | tee ${out.operations}

copy-schema-to-python-package:
  in: ./sql/create-database.autogen.sql
  out: ./targets/python/squeakyv/_schema.sql
  run: cp $in $out

